var ae=Object.defineProperty;var ie=(l,d,m)=>d in l?ae(l,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[d]=m;var h=(l,d,m)=>ie(l,typeof d!="symbol"?d+"":d,m);(function(){"use strict";class l{constructor(e){h(this,"title");h(this,"description");h(this,"colors");h(this,"spinTime");h(this,"displayWinnerDialog");h(this,"winnerMessage");h(this,"confetti");h(this,"indefiniteSpin");h(this,"duringSpinSound");h(this,"duringSpinSoundVolume");h(this,"afterSpinSound");h(this,"afterSpinSoundVolume");h(this,"image");h(this,"hubSize");h(this,"type");this.title=(e==null?void 0:e.title)??"",this.description=(e==null?void 0:e.description)??"",this.colors=(e==null?void 0:e.colors)??m,this.spinTime=(e==null?void 0:e.spinTime)??10,this.displayWinnerDialog=(e==null?void 0:e.displayWinnerDialog)??!0,this.winnerMessage=(e==null?void 0:e.winnerMessage)??"",this.confetti=(e==null?void 0:e.confetti)??"fireworks",this.indefiniteSpin=(e==null?void 0:e.indefiniteSpin)??!1,this.duringSpinSound=(e==null?void 0:e.duringSpinSound)??"tick",this.duringSpinSoundVolume=(e==null?void 0:e.duringSpinSoundVolume)??.5,this.afterSpinSound=(e==null?void 0:e.afterSpinSound)??"SMALL_CROWD_APPLAUSE-Yannick_Lemieux-1268806408.mp3",this.afterSpinSoundVolume=(e==null?void 0:e.afterSpinSoundVolume)??.5,this.image=(e==null?void 0:e.image)??"",this.hubSize=(e==null?void 0:e.hubSize)??"S",this.type=(e==null?void 0:e.type)??"color"}}const d={XXS:.05,XS:.1,S:.25,M:.33,L:.5,XL:.75},m=["#3369E8","#D50F25","#8E44AD","#EEB211","#009925"],w=60,k=.005,A=15e-5,B={angle:0,speed:k,phase:"demo",ticksInPhase:0},L=i=>({demo:a=>P(a,"accelerating"),accelerating:a=>a,constant:a=>v(a),decelerating:a=>a,stopped:a=>P(a,"accelerating")})[i.phase](i),O=(i,e,a)=>_({demo:t=>({...t,speed:k}),accelerating:t=>$(t,e,a),constant:t=>t,decelerating:t=>U(t,e),stopped:t=>({...t,speed:0})}[i.phase](V(i))),V=i=>{let e=i.angle+i.speed;return e>=2*Math.PI&&(e-=2*Math.PI),{...i,angle:e}},_=i=>({...i,ticksInPhase:i.ticksInPhase+1}),$=(i,e,a)=>i.ticksInPhase>=y(e)?a?P(i,"constant"):v(i):{...i,speed:i.speed+T()},U=(i,e)=>i.ticksInPhase>=F(e)?P(i,"stopped"):{...i,speed:i.speed*X(e)},v=i=>({...i,angle:Math.random()*2*Math.PI,phase:"decelerating",ticksInPhase:0}),P=(i,e)=>({...i,phase:e,ticksInPhase:0}),y=i=>Math.min(w,Math.floor(i*w/3)),T=()=>.6/w,F=i=>i*w-y(i),X=i=>Math.exp(Math.log(A/(k+y(i)*T()))/F(i));class E{constructor(e){h(this,"config");h(this,"state");h(this,"entries");h(this,"onStarted");h(this,"onPointerIndexChanged");h(this,"onStopped");this.config=(e==null?void 0:e.config)??new l,this.state=(e==null?void 0:e.state)??B,this.entries=(e==null?void 0:e.entries)??H,this.onStarted=e==null?void 0:e.onStarted,this.onPointerIndexChanged=e==null?void 0:e.onPointerIndexChanged,this.onStopped=e==null?void 0:e.onStopped}click(){if(!this.entries.length)return;const e=this.state,a=L(this.state);this.onStarted&&a.phase!==e.phase&&a.phase==="accelerating"&&this.onStarted(),this.state=a}tick(){const e=this.state,a=O(e,this.config.spinTime,this.config.indefiniteSpin);if(this.onPointerIndexChanged){const n=I({entries:this.entries,state:e}),t=I({entries:this.entries,state:a});t!==n&&this.onPointerIndexChanged(t)}this.onStopped&&a.phase!==e.phase&&a.phase==="stopped"&&this.onStopped({winner:G(this),color:J(this)}),this.state=a}setConfig(e){this.config=e}setEntries(e){this.entries=e}}const I=i=>Math.round(i.state.angle/(2*Math.PI/(i.entries.length||1)))%(i.entries.length||1),G=i=>i.entries[I(i)],J=i=>i.config.type==="image"||!i.config.colors.length?null:i.config.colors[I(i)%i.config.colors.length],Y=()=>crypto.randomUUID().split("-")[0],H=["Ali","Beatriz","Charles","Diya","Eric","Fatima","Gabriel","Hanna"].map(i=>({text:i,id:Y()}));class K{constructor(){h(this,"resultCache",new Map)}getFont(e,a,n,t,s){const r=this.getCachedResult(a,n,t,s);if(r)return r;let c=200;const g="Quicksand";a.forEach(M=>{const R=Q(e,M,g,n,t,s);R<c&&(c=R)});const f=`500 ${c}px ${g}`;return this.cacheResult(a,n,t,s,f),f}getCachedResult(e,a,n,t){return this.resultCache.get(N(e,a,n,t))}cacheResult(e,a,n,t,s){this.resultCache.set(N(e,a,n,t),s)}clearFontCache(){this.resultCache.clear()}}const Q=(i,e,a,n,t,s)=>j(i,n,t,s,a,e,3,200),j=(i,e,a,n,t,s,r,c)=>{let g;do g=Math.round((r+c)/2),q(i,e,a,n/2,s,`500 ${g}px ${t}`,g)?r=g:c=g;while(Math.abs(c-r)>=2);return g},q=(i,e,a,n,t,s,r)=>{if(!t)return!0;i.font=s;const{width:c}=i.measureText(D(t));return Z(n,e,a,c,r)},Z=(i,e,a,n,t)=>(e**2-(t/2)**2)**.5-Math.max(t*Math.cos(i)/(2*Math.sin(i)),a)>=n,N=(i,e,a,n)=>JSON.stringify({texts:i,wheelRadius:e,hubRadius:a,smallestAngle:n}),D=i=>i.length<=18?i:i.substring(0,17)+"â€¦",x=i=>{const e=p(i),a=1.05/(e+.05),n=(e+.05)/.05;return a>n?"#FFFFFF":"#000000"},b=i=>+`0x${i}`/255,p=i=>{i=i.replace("#","");const a=[b(i.substring(0,2)),b(i.substring(2,4)),b(i.substring(4,6))].map(n=>n<=.03928?n/12.92:((n+.055)/1.055)**2.4);return .2126*a[0]+.7152*a[1]+.0722*a[2]};class ee{constructor(){h(this,"imageCache",new Map);h(this,"fontPicker",new K)}refresh(){const e=this.imageCache.get("shadow"),a=this.imageCache.get("pointer");this.imageCache.clear(),e&&this.imageCache.set("shadow",e),a&&this.imageCache.set("pointer",a),this.fontPicker.clearFontCache()}async draw(e,a){e.clearRect(0,0,e.canvas.width,e.canvas.height),this.drawShadow(e),this.drawBackground(e,a),this.drawWheel(e,a),this.drawCenterImage(e,a),this.drawPointer(e)}drawShadow(e){this.imageCache.has("shadow")||this.drawShadowNoCache(u(e)),e.drawImage(this.imageCache.get("shadow"),0,0)}drawShadowNoCache(e){const{width:a,height:n}=e.canvas,t=a/2,s=n/2,r=o(e),c=e.createRadialGradient(t,s,r,t,s+r/75,r*26/25);c.addColorStop(0,"rgba(0, 0, 0, 0.25)"),c.addColorStop(1,"transparent"),e.fillStyle=c,e.fillRect(0,0,a,n),this.imageCache.set("shadow",e.canvas)}drawBackground(e,a){if(a.config.type!=="image"||(this.imageCache.has("background")||this.drawBackgroundNoCache(u(e),a.config.image),this.imageCache.get("background")===null))return;e.save();const{width:n,height:t}=e.canvas;e.translate(n/2,t/2),e.rotate(a.state.angle),e.translate(-n/2,-t/2),e.drawImage(this.imageCache.get("background"),0,0),e.restore()}async drawBackgroundNoCache(e,a){this.imageCache.set("background",null);const n=await W(a),t=o(e),s=t*2/Math.min(n.width,n.height),r=n.width*s,c=(t*2-r)/2,g=n.height*s,f=(t*2-g)/2;e.save(),e.beginPath(),e.translate(e.canvas.width/2,e.canvas.height/2),e.arc(0,0,t,0,Math.PI*2),e.clip(),e.translate(-t,-t),e.drawImage(n,c,f,r,g),e.restore(),this.imageCache.set("background",e.canvas)}drawWheel(e,a){this.imageCache.has("wheel")||this.drawWheelNoCache(u(e),a),e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(a.state.angle),e.translate(-e.canvas.width/2,-e.canvas.height/2),e.drawImage(this.imageCache.get("wheel"),0,0),e.restore()}drawWheelNoCache(e,a){this.drawSlices(e,a),this.drawCenter(e,a),this.imageCache.set("wheel",e.canvas)}drawSlices(e,a){this.imageCache.has("slices")||this.drawSlicesNoCache(u(e),a),e.drawImage(this.imageCache.get("slices"),0,0)}drawSlicesNoCache(e,a){e.save(),e.translate(e.canvas.width/2,e.canvas.height/2);const n=o(e);e.font=this.fontPicker.getFont(e,a.entries.map(t=>t.text),n*15/16,n*d[a.config.hubSize]*17/16,2*Math.PI/a.entries.length),a.entries.forEach((t,s)=>{this.drawSlice(e,a,s),e.rotate(-2*Math.PI/a.entries.length)}),e.restore(),this.imageCache.set("slices",e.canvas)}drawSlice(e,a,n){const t=o(e),s=2*Math.PI/a.entries.length;if(a.config.type==="color"){const r=a.config.colors[n%a.config.colors.length];this.drawSliceBg(e,t,s,r),this.drawText(e,a.entries[n].text,t,x(r))}else this.drawText(e,a.entries[n].text,t,"white","black")}drawSliceBg(e,a,n,t){e.beginPath(),e.moveTo(0,0),e.arc(0,0,a,-n/2,n/2),e.lineTo(0,0),e.fillStyle=t,e.fill()}drawText(e,a,n,t,s){e.lineJoin="round",e.textBaseline="middle",e.textAlign="end",e.fillStyle=t;const r=D(a);s&&(e.strokeStyle=s,e.lineWidth=3,e.strokeText(r,n*15/16,0)),e.fillText(r,n*15/16,0)}drawCenter(e,a){a.config.type==="color"&&(this.imageCache.has("center")||this.drawCenterNoCache(u(e),d[a.config.hubSize]),e.drawImage(this.imageCache.get("center"),0,0))}drawCenterNoCache(e,a){e.translate(e.canvas.width/2,e.canvas.height/2),e.beginPath(),e.arc(0,0,o(e)*a,0,2*Math.PI),e.fillStyle="white",e.fill(),this.imageCache.set("center",e.canvas)}async drawCenterImage(e,a){if(a.config.type!=="color"||!a.config.image||(this.imageCache.has("center-image")||this.drawCenterImageNoCache(u(e),a.config.image,d[a.config.hubSize]),this.imageCache.get("center-image")===null))return;e.save();const{width:n,height:t}=e.canvas;e.translate(n/2,t/2),e.rotate(a.state.angle);const s=o(e)*d[a.config.hubSize];e.translate(-s,-s),e.drawImage(this.imageCache.get("center-image"),0,0),e.restore()}async drawCenterImageNoCache(e,a,n){this.imageCache.set("center-image",null);const t=await W(a),s=o(e)*n,r=s*2/Math.min(t.width,t.height),c=t.width*r,g=(s*2-c)/2-s,f=t.height*r,M=(s*2-f)/2-s;e.save(),e.beginPath(),e.translate(s,s),e.arc(0,0,s,0,Math.PI*2,!0),e.clip(),e.drawImage(t,g,M,c,f),e.restore(),this.imageCache.set("center-image",e.canvas)}drawPointer(e){this.imageCache.has("pointer")||this.drawPointerNoCache(u(e)),e.drawImage(this.imageCache.get("pointer"),0,0)}drawPointerNoCache(e){e.save();const{width:a,height:n}=e.canvas;e.shadowColor="black",e.shadowOffsetY=4,e.shadowBlur=10,e.fillStyle="white",e.strokeStyle="black",e.moveTo(a*19/20,n*19/40),e.beginPath(),e.lineTo(a*19/20,n*21/40),e.lineTo(a*9/10,n/2),e.lineTo(a*19/20,n*19/40),e.fill(),e.stroke(),e.restore(),this.imageCache.set("pointer",e.canvas)}}const o=i=>Math.min(i.canvas.width,i.canvas.height)/2*.85,u=i=>new OffscreenCanvas(i.canvas.width,i.canvas.height).getContext("2d"),W=async i=>{const e=new Image;return e.src=i,await e.decode(),e};let z;const C=new ee;let S=new E;onmessage=i=>{"canvas"in i.data&&(z=i.data.canvas.getContext("2d")),"wheel"in i.data&&(S=new E(i.data.wheel),C.refresh()),"angle"in i.data&&(S.state.angle=i.data.angle,C.draw(z,S)),"config"in i.data&&(S.setConfig(i.data.config),C.refresh()),"entries"in i.data&&(S.setEntries(i.data.entries),C.refresh()),"refresh"in i.data&&C.refresh()}})();
