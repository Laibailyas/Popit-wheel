import"./disclose-version.9MAgoEoo.js";import{p as h,a as _,i as v}from"./runtime.DhpGOksZ.js";import{s as S,a as W}from"./store.Cn1dDG1t.js";import{_ as w}from"./preload-helper.Bd2dpRG3.js";import{w as f}from"./index.BaNpasK9.js";import{g as k,t as E}from"./0.CqagfooJ.js";import"./Audio.DtnWrXNT.js";import"./legacy.KgxtM81z.js";function P(u={}){const{immediate:d=!1,onNeedRefresh:a,onOfflineReady:t,onRegistered:i,onRegisteredSW:n,onRegisterError:o}=u;let e,r,c;const m=async(s=!0)=>{await r,c==null||c()};async function g(){if("serviceWorker"in navigator){if(e=await w(async()=>{const{Workbox:s}=await import("./workbox-window.prod.es5.B9K5rw8f.js");return{Workbox:s}},[]).then(({Workbox:s})=>new s("/sw.js",{scope:"/",type:"classic"})).catch(s=>{o==null||o(s)}),!e)return;c=()=>{e==null||e.messageSkipWaiting()};{let s=!1;const p=()=>{s=!0,e==null||e.addEventListener("controlling",l=>{l.isUpdate&&window.location.reload()}),a==null||a()};e.addEventListener("installed",l=>{typeof l.isUpdate>"u"?typeof l.isExternal<"u"&&l.isExternal?p():!s&&(t==null||t()):l.isUpdate||t==null||t()}),e.addEventListener("waiting",p)}e.register({immediate:d}).then(s=>{n?n("/sw.js",s):i==null||i(s)}).catch(s=>{o==null||o(s)})}}return r=g(),m}function R(u={}){const{immediate:d=!0,onNeedRefresh:a,onOfflineReady:t,onRegistered:i,onRegisteredSW:n,onRegisterError:o}=u,e=f(!1),r=f(!1),c=P({immediate:d,onOfflineReady(){r.set(!0),t==null||t()},onNeedRefresh(){e.set(!0),a==null||a()},onRegistered:i,onRegisteredSW:n,onRegisterError:o});return{needRefresh:e,offlineReady:r,updateServiceWorker:c}}function I(u,d){h(d,!0);const a=S(),t=()=>W(n,"$needRefresh",a),i=k(),{needRefresh:n,updateServiceWorker:o}=R({onRegistered:r=>r&&setInterval(r.update,4*60*60*1e3),onRegisterError:r=>console.error("SW registration error",r)}),e=()=>{i.trigger({...E,hideDismiss:!1,timeout:8e3,message:"Update available",action:{label:"Reload",response:()=>o(!0)},hoverable:!0,callback:r=>{r.status==="closed"&&n.set(!1)}})};_(()=>{t()&&e()}),v()}export{I as default};
